[sources.syslog-tcp]
type = "syslog"
address = "0.0.0.0:515"
max_length = 102_400
mode = "tcp"
path = "/var/log/messages"


[sources.http]
type = "http"
address = "0.0.0.0:80"
encoding = "text"


[sources.demo]
type = "demo_logs"
format = "syslog"


[sources.syslog-udp]
type = "syslog"
address = "0.0.0.0:515"
max_length = 102_400
mode = "udp"
path = "/var/log/messages"


[transforms.enrich]
type = "geoip"
inputs = [ "parse" ]
database = "/usr/share/vector/GeoLite.mmdb"
source = "ip_address"
target = "geoip"


[transforms.parse]
inputs = [ "syslog-tcp", "syslog-udp"]
type = "remap"
source = '''

. = parse_json!(string!(.message))

'''

[sinks.file-persist-generator]
type = "file"
inputs = [ "demo" ]
compression = "none"
path = "/var/log/dataset/vector/generator/%d/%Y-%m-%d-%H.log"

  [sinks.file-persist-generator.encoding]
  codec = "json"

[sinks.file-persist-syslog]
type = "file"
inputs = [ "syslog-tcp", "syslog-udp", "http" ]
compression = "none"
path = "/var/log/dataset/vector/syslog/%d/%Y-%m-%d-%H.log"

  [sinks.file-persist-syslog.encoding]
  codec = "json"
